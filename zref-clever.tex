% \iffalse meta-comment
%
% File: zref-clever.tex
%
% This file is part of the LaTeX package "zref-clever".
%
% Copyright (C) 2021  Gustavo Barros
%
% It may be distributed and/or modified under the conditions of the
% LaTeX Project Public License (LPPL), either version 1.3c of this
% license or (at your option) any later version.  The latest version
% of this license is in the file:
%
%    https://www.latex-project.org/lppl.txt
%
% and version 1.3 or later is part of all distributions of LaTeX
% version 2005/12/01 or later.
%
%
% This work is "maintained" (as per LPPL maintenance status) by
% Gustavo Barros.
%
% This work consists of the files zref-clever.dtx,
%                                 zref-clever.ins,
%                                 zref-clever.tex,
%                                 zref-clever-code.tex,
% and the derived files listed in MANIFEST.md.
%
% The released version of this package is available from CTAN.
%
% -----------------------------------------------------------------------
%
% The development version of the package can be found at
%
%    https://github.com/gusbrs/zref-clever
%
% for those people who are interested.
%
% -----------------------------------------------------------------------
%
% \fi

\documentclass{l3doc}

% Have \GetFileInfo pick up date and version data and used in the
% documentation.
\usepackage[cap,nameinlink=false,check,titleref]{zref-clever}

% Used in the documentation.
\usepackage[osf]{mathpazo}
\usepackage{listings}
\usepackage{newfloat}

\NewDocumentCommand\opt{m}{\texttt{#1}}

\definecolor{reffmtbox}{gray}{0.15}
\definecolor{reffmtback}{gray}{0.85}
\NewDocumentCommand\reffmt{m}{%
  \fcolorbox{reffmtbox}{reffmtback}{%
    \rule[-0.2\baselineskip]{0pt}{0.8\baselineskip}\texttt{#1}}}

\newlist{refformat}{itemize}{1}
\setlist[refformat]{label={}, beginpenalty=500, midpenalty=500}

\NewDocumentCommand\zctask{m}{%
  \begin{description}
  \item[Task] #1
  \end{description}}

\lstdefinestyle{code}{
  language=[LaTeX]TeX,
  moretexcs={
    AddToHook,
    define@key,
    patchcmd,
    eq@setnumber,
    DeclareFloatingEnvironment,
    newlist,
    setlist,
    zexternaldocument,
  }
}
\lstdefinestyle{zrefclever}{
  style=code,
  moretexcs={
    zcref,
    zlabel,
    zcsetup,
    zcLanguageSetup,
    zcRefTypeSetup,
  }
}
\lstset{
  style=zrefclever,
  basicstyle=\ttfamily,
  columns=fullflexible,
  keepspaces,
  xleftmargin=\leftmargin,
  xrightmargin=.5\leftmargin,
}
% See https://tex.stackexchange.com/a/31026 for how to use these environments
% in a .dtx context.
\lstnewenvironment{zcexample}[1][]{%
  \renewcommand{\lstlistingname}{Example}%
  \lstset{#1}%
}{}
\makeatletter
\NewDocumentCommand{\zchowto}{}{%
  \setlength\abovecaptionskip{6pt}%
  \def\@captype{zchowtofloat}}
\NewDocumentCommand{\endzchowto}{}{\medskip{}}
\NewDocumentCommand{\zcworkaround}{}{%
  \setlength\abovecaptionskip{6pt}%
  \def\@captype{zcworkaroundfloat}}
\NewDocumentCommand{\endzcworkaround}{}{\medskip{}}
\makeatother

\DeclareFloatingEnvironment[name={How to}]{zchowtofloat}
\DeclareFloatingEnvironment[name={Work around}]{zcworkaroundfloat}
\zcRefTypeSetup{zchowtofloat}{
  Name-sg = {How to},
  name-sg = {how to},
  Name-pl = {How tos},
  name-pl = {how tos},
}
\zcRefTypeSetup{zcworkaroundfloat}{
  Name-sg = {Work around},
  name-sg = {work around},
  Name-pl = {Work arounds},
  name-pl = {work arounds},
}

\begin{document}

\GetFileInfo{zref-clever.sty}

\title{%
  The \pkg{zref-clever} package%
  \thanks{This file describes \fileversion, released \filedate.}%
}

\author{%
  Gustavo Barros%
  \thanks{\url{https://github.com/gusbrs/zref-clever}}%
}

\date{\filedate}

\maketitle

\begin{abstract}
  \pkg{zref-clever} provides an user interface for making \LaTeX{}
  cross-references which automates some of their typical features, thus easing
  their input in the document and improving the consistency of typeset
  results.  A reference made with \cs{zcref} includes a ``name'' according to
  its ``type'' and lists of multiple labels can be automatically sorted and
  compressed into ranges when due.  The reference format is highly and easily
  customizable, both globally and locally.  \pkg{zref-clever} is based on
  \pkg{zref}'s extensible referencing system.
\end{abstract}

\tableofcontents

\DisableImplementation

\DocInput{zref-clever.dtx}

\end{document}
